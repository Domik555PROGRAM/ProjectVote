<Window x:Class="Project_Vote.PollPreview"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Project_Vote"
        mc:Ignorable="d"
        Title="Предварительный просмотр опроса" Height="700" Width="900"
        WindowStartupLocation="CenterOwner"
        FontFamily="Segoe UI"
        Background="#f8f9fa">
    <Window.Resources>
        <local:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
    </Window.Resources>
    <Grid Margin="30">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Заголовок -->
            <RowDefinition Height="Auto"/> <!-- Описание -->
            <RowDefinition Height="*"/>    <!-- Варианты/Вопросы -->
            <RowDefinition Height="Auto"/> <!-- Кнопка -->
        </Grid.RowDefinitions>

        <!-- Заголовок -->
        <TextBlock x:Name="TitleTextBlock" Grid.Row="0" FontSize="26" FontWeight="Normal" Margin="0,0,0,8" TextWrapping="Wrap" Foreground="#202124"/>

        <!-- Описание -->
        <Border Grid.Row="1" BorderBrush="#dadce0" BorderThickness="0,0,0,1" Padding="0,0,0,20" Margin="0,0,0,20">
             <RichTextBox x:Name="DescriptionRichTextBox" IsReadOnly="True" VerticalScrollBarVisibility="Auto" BorderThickness="0" Background="Transparent" Foreground="#5f6368" FontSize="14"/>
        </Border>

        <!-- Контейнер для вариантов или вопросов -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Padding="0,0,5,0">
            <ItemsControl x:Name="PollItemsControl">
                <ItemsControl.Resources>
                    <!-- Конвертеры -->
                    <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>

                    <!-- Стиль для текста варианта ответа -->
                    <Style x:Key="OptionTextStyle" TargetType="TextBlock">
                        <Setter Property="VerticalAlignment" Value="Center"/>
                        <Setter Property="TextWrapping" Value="Wrap"/>
                        <Setter Property="FontSize" Value="14"/>
                        <Setter Property="Foreground" Value="#202124"/>
                        <Setter Property="Margin" Value="12,0,0,0"/>
                    </Style>

                    <!-- Стиль для RadioButton -->
                    <Style x:Key="OptionRadioButtonStyle" TargetType="RadioButton">
                        <Setter Property="VerticalAlignment" Value="Center"/>
                        <Setter Property="Cursor" Value="Hand"/>
                    </Style>

                    <!-- Стиль для CheckBox -->
                    <Style x:Key="OptionCheckBoxStyle" TargetType="CheckBox">
                        <Setter Property="VerticalAlignment" Value="Center"/>
                        <Setter Property="Cursor" Value="Hand"/>
                    </Style>

                    <!-- Шаблон для ПРОСТОГО ВАРИАНТА (Одиночный/Множественный выбор) - Стиль карточки -->
                    <DataTemplate x:Key="SimpleOptionTemplate">
                        <Border Background="White" CornerRadius="8" BorderBrush="#dadce0" BorderThickness="1" Padding="20, 15" Margin="0,5,0,5">
                             <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <ContentControl x:Name="SelectionControl" Grid.Column="0"/>
                                <TextBlock Text="{Binding Text}" Grid.Column="1" Style="{StaticResource OptionTextStyle}"/>
                            </Grid>
                        </Border>
                    </DataTemplate>

                    <!-- Шаблон для ВОПРОСА в ТЕСТЕ - Стиль карточки Google Forms -->
                    <DataTemplate x:Key="QuestionTemplate">
                        <Border Background="White" CornerRadius="8" BorderBrush="#dadce0" BorderThickness="1" Margin="0,15,0,0" Padding="24">
                            <StackPanel>
                                <TextBlock Text="{Binding QuestionText}" FontSize="16" FontWeight="Normal" Foreground="#202124" Margin="0,0,0,20" TextWrapping="Wrap"/>
                                
                                <!-- Изображение вопроса, если есть -->
                                <Border BorderBrush="#dadce0" BorderThickness="1" CornerRadius="4" 
                                        Visibility="{Binding HasImage, Converter={StaticResource BooleanToVisibilityConverter}}"
                                        Margin="0,0,0,15" MaxHeight="500">
                                    <StackPanel>
                                        <Image x:Name="QuestionImage" Source="{Binding QuestionImageSource}" 
                                               Stretch="Uniform" Margin="5" MaxHeight="450"/>
                                        <TextBlock Text="{Binding ImageDescription}" Margin="8" 
                                                   TextWrapping="Wrap" Foreground="#5f6368"
                                                   Visibility="{Binding ImageDescription, Converter={StaticResource StringToVisibilityConverter}}"/>
                                    </StackPanel>
                                </Border>
                                
                                <ItemsControl x:Name="QuestionOptionsItemsControl" ItemsSource="{Binding Options}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Margin="0,8">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>
                                                    <ContentControl x:Name="QuestionOptionSelectionControl" Grid.Column="0" />
                                                    <TextBlock Text="{Binding Text}" Grid.Column="1" Style="{StaticResource OptionTextStyle}"/>
                                                </Grid>
                                                
                                                <!-- Изображение варианта ответа, если есть -->
                                                <Border BorderBrush="#dadce0" BorderThickness="1" CornerRadius="4" 
                                                        Visibility="{Binding HasImage, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                        Margin="30,8,0,5" MaxHeight="400">
                                                    <StackPanel>
                                                        <Image x:Name="OptionImage" Source="{Binding OptionImageSource}" 
                                                               Stretch="Uniform" Margin="5" MaxHeight="350"/>
                                                        <TextBlock Text="{Binding ImageDescription}" Margin="8" 
                                                                   TextWrapping="Wrap" Foreground="#5f6368"
                                                                   Visibility="{Binding ImageDescription, Converter={StaticResource StringToVisibilityConverter}}"/>
                                                    </StackPanel>
                                                </Border>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.Resources>
            </ItemsControl>
        </ScrollViewer>

        <!-- Кнопка для закрытия -->
        <Button Grid.Row="3" Content="Закрыть" HorizontalAlignment="Right" Margin="0,25,0,0" Padding="20,8" Click="CloseButton_Click" Background="#1a73e8" Foreground="White" BorderThickness="0" FontWeight="SemiBold" Cursor="Hand">
             <Button.Resources>
                <Style TargetType="Border">
                    <Setter Property="CornerRadius" Value="4"/>
                </Style>
            </Button.Resources>
        </Button>

    </Grid>
</Window>
